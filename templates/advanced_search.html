{% extends "base.html" %}

{% block content %}
        <!-- Search Form -->
        <body class="bg-gradient-to-br from-blue-50 to-gray-100 min-h-screen">
        <form method="GET" action="{{ url_for('main.advanced_search') }}" class="bg-white shadow-lg rounded-lg px-8 pt-6 pb-8 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Location Filter -->
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="location">
                        Location
                    </label>
                    <select name="location" id="location" class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500">
                        <option value="">All Locations</option>
                        {% for location in locations %}
                        <option value="{{ location }}" {% if filters.location == location %}selected{% endif %}>
                            {{ location }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Status Filter -->
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="status">
                        Status
                    </label>
                    <select name="status" id="status" class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500">
                        <option value="">All Statuses</option>
                        {% for status in statuses %}
                        <option value="{{ status }}" {% if filters.status == status %}selected{% endif %}>
                            {{ status }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Need Filter -->
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="need">
                        Need
                    </label>
                    <select name="need" id="need" class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500">
                        <option value="">All Needs</option>
                        <option value="medical">Medical Care</option>
                        <option value="food">Food/Water</option>
                        <option value="shelter">Shelter</option>
                        <option value="rescue">Rescue/Relocation</option>
                        <option value="other">Other</option>
                        <!-- {% for need in needs %}
                        <option value="{{ need }}" {% if filters.need == need %}selected{% endif %}>
                            {{ need }}
                        </option>
                        {% endfor %} -->
                    </select>
                </div>
                
                <!-- Date Range -->
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="date_from">
                        From Date
                    </label>
                    <input type="date" name="date_from" id="date_from"
                           value="{{ filters.date_from }}"
                           class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500">
                </div>
                
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="date_to">
                        To Date
                    </label>
                    <input type="date" name="date_to" id="date_to"
                           value="{{ filters.date_to }}"
                           class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500">
                </div>
                
                <!-- Sort Options -->
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="sort_by">
                        Sort By
                    </label>
                    <select name="sort_by" id="sort_by" class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500">
                        {% for value, label in sort_options %}
                        <option value="{{ value }}" {% if filters.sort_by == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="sort_order">
                        Sort Order
                    </label>
                    <select name="sort_order" id="sort_order" class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500">
                        <option value="desc" {% if filters.sort_order == 'desc' %}selected{% endif %}>Descending</option>
                        <option value="asc" {% if filters.sort_order == 'asc' %}selected{% endif %}>Ascending</option>
                    </select>
                </div>
            </div>
            
            <div class="flex items-center justify-end mt-6">
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-300 ease-in-out transform hover:scale-105">
                    Search
                </button>
            </div>
        </form>
        
        <!-- Results Section -->
        {% if cases %}
        <div class="bg-white shadow-lg rounded-lg px-8 pt-6 pb-8">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Search Results</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for case in cases %}
                <div class="border rounded-lg p-4 hover:shadow-md transition duration-300 ease-in-out">
                    <h3 class="font-bold text-lg mb-2 text-blue-600">Case #{{ case.id[:8] }}</h3>
                    <p class="mb-1"><span class="font-semibold">Location:</span> {{ case.location }}</p>
                    <p class="mb-1"><span class="font-semibold">Need:</span> {{ case.need }}</p>
                    <p class="mb-1"><span class="font-semibold">Status:</span> 
                        <span class="px-2 py-1 rounded-full text-xs font-semibold
                        {% if case.status == 'OPEN' %}bg-green-200 text-green-800
                        {% else %}bg-gray-200 text-gray-800{% endif %}">
                            {{ case.status }}
                        </span>
                    </p>
                    <p class="mb-3"><span class="font-semibold">Created:</span> {{ case.created_at.strftime('%Y-%m-%d') }}</p>
                    <a href="{{ url_for('main.view_case_details', case_id=case.id) }}" 
                       class="inline-block bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition duration-300 ease-in-out transform hover:scale-105">
                        View Details
                    </a>
                </div>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if pagination.pages > 1 %}
            <div class="flex justify-center mt-8">
                <nav class="inline-flex rounded-md shadow-sm" aria-label="Pagination">
                    {% for page_num in range(1, pagination.pages + 1) %}
                    <a href="{{ url_for('main.advanced_search', page=page_num, **filters) }}"
                       class="px-4 py-2 {% if page_num == current_page %}bg-blue-500 text-white{% else %}bg-white text-blue-500{% endif %} border-r border-gray-200 hover:bg-blue-50 {% if loop.first %}rounded-l-md{% endif %} {% if loop.last %}rounded-r-md border-r-0{% endif %} focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        {{ page_num }}
                    </a>
                    {% endfor %}
                </nav>
            </div>
            {% endif %}
        </div>
        {% else %}
        <div class="bg-white shadow-lg rounded-lg px-8 py-6 text-center">
            <p class="text-gray-600 text-lg">No cases found matching your criteria.</p>
        </div>
        {% endif %}
    </div>
</body>
{% endblock %}